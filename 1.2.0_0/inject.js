(()=>{"use strict";const t={silent:Number.NEGATIVE_INFINITY,fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,ready:3,start:3,box:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},e={silent:{level:-1},fatal:{level:t.fatal},error:{level:t.error},warn:{level:t.warn},log:{level:t.log},info:{level:t.info},success:{level:t.success},fail:{level:t.fail},ready:{level:t.info},start:{level:t.info},box:{level:t.info},debug:{level:t.debug},trace:{level:t.trace},verbose:{level:t.verbose}};function s(t){return null!==t&&"object"==typeof t}function o(t,e,r=".",i){if(!s(e))return o(t,{},r,i);const n=Object.assign({},e);for(const e in t){if("__proto__"===e||"constructor"===e)continue;const l=t[e];null!=l&&(i&&i(n,e,l,r)||(Array.isArray(l)&&Array.isArray(n[e])?n[e]=[...l,...n[e]]:s(l)&&s(n[e])?n[e]=o(l,n[e],(r?`${r}.`:"")+e.toString(),i):n[e]=l))}return n}const r=(...t)=>t.reduce(((t,e)=>o(t,e,"",undefined)),{});let i=!1;const n=[];class l{constructor(t={}){const s=t.types||e;this.options=r({...t,defaults:{...t.defaults},level:a(t.level,s),reporters:[...t.reporters||[]]},{types:e,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const t in s){const e={type:t,...this.options.defaults,...s[t]};this[t]=this._wrapLogFn(e),this[t].raw=this._wrapLogFn(e,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(t){this.options.level=a(t,this.options.types,this.options.level)}prompt(t,e){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(t,e)}create(t){const e=new l({...this.options,...t});return this._mockFn&&e.mockTypes(this._mockFn),e}withDefaults(t){return this.create({...this.options,defaults:{...this.options.defaults,...t}})}withTag(t){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+t:t})}addReporter(t){return this.options.reporters.push(t),this}removeReporter(t){if(t){const e=this.options.reporters.indexOf(t);if(e>=0)return this.options.reporters.splice(e,1)}else this.options.reporters.splice(0);return this}setReporters(t){return this.options.reporters=Array.isArray(t)?t:[t],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const t in this.options.types)console["__"+t]||(console["__"+t]=console[t]),console[t]=this[t].raw}restoreConsole(){for(const t in this.options.types)console["__"+t]&&(console[t]=console["__"+t],delete console["__"+t])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(t,e){t&&(t.__write||(t.__write=t.write),t.write=t=>{this[e].raw(String(t).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(t){t&&t.__write&&(t.write=t.__write,delete t.__write)}pauseLogs(){i=!0}resumeLogs(){i=!1;const t=n.splice(0);for(const e of t)e[0]._logFn(e[1],e[2])}mockTypes(t){const e=t||this.options.mockFn;if(this._mockFn=e,"function"==typeof e)for(const t in this.options.types)this[t]=e(t,this.options.types[t])||this[t],this[t].raw=this[t]}_wrapLogFn(t,e){return(...s)=>{if(!i)return this._logFn(t,s,e);n.push([this,t,s,e])}}_logFn(t,e,s){if((t.level||0)>this.level)return!1;const o={date:new Date,args:[],...t,level:a(t.level,this.options.types)};var r,i;s||1!==e.length||(r=e[0],i=r,"[object Object]"!==Object.prototype.toString.call(i)||!r.message&&!r.args||r.stack)?o.args=[...e]:Object.assign(o,e[0]),o.message&&(o.args.unshift(o.message),delete o.message),o.additional&&(Array.isArray(o.additional)||(o.additional=o.additional.split("\n")),o.args.push("\n"+o.additional.join("\n")),delete o.additional),o.type="string"==typeof o.type?o.type.toLowerCase():"log",o.tag="string"==typeof o.tag?o.tag:"";const n=(t=!1)=>{const e=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&e>0){const t=[...this._lastLog.object.args];e>1&&t.push(`(repeated ${e} times)`),this._log({...this._lastLog.object,args:t}),this._lastLog.count=1}t&&(this._lastLog.object=o,this._log(o))};clearTimeout(this._lastLog.timeout);const l=this._lastLog.time&&o.date?o.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=o.date,l<this.options.throttle)try{const t=JSON.stringify([o.type,o.tag,o.args]),e=this._lastLog.serialized===t;if(this._lastLog.serialized=t,e&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin))return void(this._lastLog.timeout=setTimeout(n,this.options.throttle))}catch{}n(!0)}_log(t){for(const e of this.options.reporters)e.log(t,{options:this.options})}}function a(t,e={},s=3){return void 0===t?s:"number"==typeof t?t:e[t]&&void 0!==e[t].level?e[t].level:s}l.prototype.add=l.prototype.addReporter,l.prototype.remove=l.prototype.removeReporter,l.prototype.clear=l.prototype.removeReporter,l.prototype.withScope=l.prototype.withTag,l.prototype.mock=l.prototype.mockTypes,l.prototype.pause=l.prototype.pauseLogs,l.prototype.resume=l.prototype.resumeLogs;class p{constructor(t){this.options={...t},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(t){return t<1?console.__error||console.error:1===t?console.__warn||console.warn:console.__log||console.log}log(t){const e=this._getLogFn(t.level),s="log"===t.type?"":t.type,o=t.tag||"",r=`\n      background: ${this.typeColorMap[t.type]||this.levelColorMap[t.level]||this.defaultColor};\n      border-radius: 0.5em;\n      color: white;\n      font-weight: bold;\n      padding: 2px 0.5em;\n    `,i=`%c${[o,s].filter(Boolean).join(":")}`;"string"==typeof t.args[0]?e(`${i}%c ${t.args[0]}`,r,"",...t.args.slice(1)):e(i,r,...t.args)}}function c(t={}){const e=function(t={}){return new l(t)}({reporters:t.reporters||[new p({})],prompt:(t,e={})=>"confirm"===e.type?Promise.resolve(confirm(t)):Promise.resolve(prompt(t)),...t});return e}let h;c();const u=(t,e)=>{if(t)if(Array.isArray(t)){let s=[],o=!1,r=!1;if(t.length>0){const e=t[0];e?.entryId&&"Tweet"===e?.content?.itemContent?.tweet_results?.result?.__typename?o=!0:e?.entryId&&"Tweet"===e?.item?.itemContent?.tweet_results?.result?.__typename&&(r=!0)}if(o)s=t.map((t=>t?.content?.itemContent?.tweet_results?.result)).filter((t=>!!t&&"Tweet"===t.__typename&&!!t.rest_id));else{if(!r)return void t.forEach((t=>u(t,e)));s=t.map((t=>t?.item?.itemContent?.tweet_results?.result)).filter((t=>!!t&&"Tweet"===t.__typename&&!!t.rest_id))}s.forEach((t=>{t.rest_id&&!h.has(t.rest_id)&&(e.push(t),h.add(t.rest_id))})),t.forEach((t=>u(t,e)))}else if("object"==typeof t&&null!==t){if("Tweet"===t.__typename&&t.rest_id){const s=t;h.has(s.rest_id)||(e.push(s),h.add(s.rest_id))}else if("Tweet"===t.tweet_results?.result?.__typename&&t.tweet_results.result.rest_id){const s=t.tweet_results.result;h.has(s.rest_id)||(e.push(s),h.add(s.rest_id))}else if("Tweet"===t.tweetResult?.result?.__typename&&t.tweetResult.result.rest_id){const s=t.tweetResult.result;h.has(s.rest_id)||(e.push(s),h.add(s.rest_id))}Object.values(t).forEach((t=>{u(t,e)}))}},d=function(t){const e=c().withTag("X-Media-Downloader - inject_script");return(...t)=>{e.info(...t)}}();d("成功注入inject脚本---xmedia"),function(t){const e=window.XMLHttpRequest;window.XMLHttpRequest=function(){const s=new e,o=s.send,r=s.open;let i,n="";const l={},a=s.setRequestHeader;return s.setRequestHeader=function(t,e){return l[t.toLowerCase()]=e,a.apply(this,[t,e])},s.open=function(t,e){return n=e,this._method=t,r.apply(this,arguments)},s.send=function(e){if(Array.isArray(t.targetUrl)?t.targetUrl.some((t=>t instanceof RegExp?t.test(n):n.includes(t))):t.targetUrl instanceof RegExp?t.targetUrl.test(n):n.includes(t.targetUrl)){try{const o=new URL(n,window.location.origin),r={};if(o.searchParams.forEach(((t,e)=>{r[e]=t})),i={method:this._method||"GET",url:n,query:Object.keys(r).length>0?r:void 0,headers:l,body:e?"application/json"===l["content-type"]?JSON.parse(e):e:null,withCredentials:s.withCredentials},t.beforeRequest){const s=t.beforeRequest(i);s&&(e=JSON.stringify(s.body))}t.onRequest?.(i)}catch(e){t.onError?.(new Error("解析请求体失败: "+e),"request")}this.addEventListener("load",(function(){try{const e={};this.getAllResponseHeaders()?.split("\r\n").forEach((t=>{const[s,o]=t.split(": ");s&&o&&(e[s.toLowerCase()]=o)}));const s=(e["content-type"]||"").includes("application/json")?JSON.parse(this.response):this.response,o={status:this.status,headers:e,response:s,requestConfig:i};if(t.afterResponse){const e=t.afterResponse(o);e&&Object.defineProperty(this,"response",{writable:!0,value:JSON.stringify(e)})}t.onResponse?.(o)}catch(e){t.onError?.(new Error("解析响应失败: "+e),"response")}}))}return o.apply(this,arguments)},s}}({targetUrl:"/api/graphql",onRequest:()=>{},onResponse:t=>{const e=new URL(t.requestConfig.url).pathname.split("/").at(-1);try{const o=(t=>{if(!t)return[];const e=[];return h=new Set,u(t,e),0===e.length&&console.warn("Could not find any tweet results in the provided JSON data using recursive search."),e})(t.response);if(o.length>0){const r=t.requestConfig.url,i=t.requestConfig.query,n=t.requestConfig.body,l=!r?.includes("cursor")&&!i?.variables?.includes("cursor")&&!n?.variables?.cursor;"FROM_INJECT_API_CACHE",s={isFirstPage:l,type:e,data:o},window.dispatchEvent(new CustomEvent("FROM_INJECT_API_CACHE",{detail:s}))}}catch(t){d("error",t)}var s}})})();
//# sourceMappingURL=inject.js.map